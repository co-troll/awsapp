# name: GitHub Actions Demo
# run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
# on: [push]
# jobs:
#   Explore-GitHub-Actions:
#     runs-on: ubuntu-latest
#     steps:
#       - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
#       - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
#       - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
#       - name: Check out repository code
#         uses: actions/checkout@v4
#       - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
#       - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
#       - name: List files in the repository
#         run: |
#           ls ${{ github.workspace }}
#       - run: echo "ğŸ This job's status is ${{ job.status }}."

# name: CI/CD êµ¬ì¶•

# # ì´ë²¤íŠ¸ë¥¼ êµ¬ë…
# on: 
#   push: # push ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì‹¤í–‰
#     branches: # pushê°€ ë°œìƒí•  ë¸Œëœì¹˜ê°€ ë­ì¼ë•Œ ì‹¤í–‰í• ì§€
#       - main
# jobs: # ì‘ì—…ì˜ ë‹¨ìœ„
#   myTest: #ì‹ë³„ì ì´ë¦„(ìš°ë¦¬ê°€ ì´ë¦„ ì •í•´ë„ ë¨)
#     runs-on: ubuntu-latest # ì‚¬ìš©í•œ ìš´ì˜ì²´ì œ

#     # ì‘ì—…ì˜ ê°€ì¥ ì‘ì€ ë‹¨ìœ„
#     steps: 
#       - name: shell console test # ê°€ì¥ ì‘ì€ ì‘ì—… ë‹¨ìœ„ì˜ ì´ë¦„
#         run: echo "my ci/cd" # ì‘ì—…ì—ì„œ ì‹¤í–‰í•  ì‰¡ ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© echo ì¶œë ¥ ëª…ë ¹ì–´

#       - name: mykey # ì´ë¦„ì€ mykey
#         run: echo ${{ secrets.HOST }}
  
name: CI/CD êµ¬ì¶•

on:
  push:
    branches:
      - main

jobs:
  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v4 # uses ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬

      - name: ssh key
        uses: webfactory/ssh-agent@v0.5.3
        with: # ì‘ì„±í•  ì†ì„±ì„ ì •ì˜
          ssh-private-key: ${{ secrets.AWS_SECRET_KEY }}

      - name: ssh ec2 ì ‘ì†
        uses: appleboy/ssh-action@v1.0.3
        with:
          key: ${{ secrets.AWS_SECRET_KEY }}
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          port: ${{ secrets.PORT }}
          script: | # ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸
            cd /home/ubuntu/study
            node app.js